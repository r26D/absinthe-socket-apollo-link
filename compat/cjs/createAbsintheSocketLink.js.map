{"version":3,"file":"createAbsintheSocketLink.js","sources":["../../src/createAbsintheSocketLink.js"],"sourcesContent":["// @flow\n\nimport { ApolloLink } from '@apollo/client';\nimport {send, toObservable, unobserveOrCancel} from \"@absinthe/socket\";\nimport {compose} from \"flow-static-land/lib/Fun\";\nimport {print} from \"graphql\";\n\nimport type {AbsintheSocket, GqlRequest, Observer} from \"@absinthe/socket\";\nimport type {DocumentNode} from \"graphql/language/ast\";\n\ntype ApolloOperation<Variables> = {|\n  query: DocumentNode,\n  variables: Variables\n|};\n\nconst unobserveOrCancelIfNeeded = (absintheSocket, notifier, observer) => {\n  if (notifier && observer) {\n    unobserveOrCancel(absintheSocket, notifier, observer);\n  }\n};\n\nconst notifierToObservable = (absintheSocket, onError, onStart) => notifier =>\n  toObservable(absintheSocket, notifier, {\n    onError,\n    onStart,\n    unsubscribe: unobserveOrCancelIfNeeded\n  });\n\nconst getRequest = <Variables: Object>({\n  query,\n  variables\n}: ApolloOperation<Variables>): GqlRequest<Variables> => ({\n  operation: print(query),\n  variables\n});\n\n/**\n * Creates a terminating ApolloLink to request operations using given\n * AbsintheSocket instance\n */\nconst createAbsintheSocketLink = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  onError?: $ElementType<Observer<Result, Variables>, \"onError\">,\n  onStart?: $ElementType<Observer<Result, Variables>, \"onStart\">\n) =>\n  new ApolloLink(\n    compose(\n      notifierToObservable(absintheSocket, onError, onStart),\n      request => send(absintheSocket, request),\n      getRequest\n    )\n  );\n\nexport default createAbsintheSocketLink;\n"],"names":["unobserveOrCancelIfNeeded","absintheSocket","notifier","observer","unobserveOrCancel","notifierToObservable","onError","onStart","toObservable","unsubscribe","getRequest","query","variables","operation","print","createAbsintheSocketLink","ApolloLink","compose","request","send"],"mappings":";;;;;;;;;;;;;;;AAeA,IAAMA,yBAAyB,GAAG,mCAACC,cAAD,EAAiBC,QAAjB,EAA2BC,QAA3B,EAAwC;AAAA;;AACxE,MAAID,QAAQ,IAAIC,QAAhB,EAA0B;AACxBC,IAAAA,wBAAiB,CAACH,cAAD,EAAiBC,QAAjB,EAA2BC,QAA3B,CAAjB;AACD;AACF,CAJ8B,gBAA/B;;AAMA,IAAME,oBAAoB,GAAG,8BAACJ,cAAD,EAAiBK,OAAjB,EAA0BC,OAA1B;AAAA;;AAAA;;AAAA,SAAsC,UAAAL,QAAQ;AAAA;;AAAA,WACzEM,mBAAY,CAACP,cAAD,EAAiBC,QAAjB,EAA2B;AACrCI,MAAAA,OAAO,EAAPA,OADqC;AAErCC,MAAAA,OAAO,EAAPA,OAFqC;AAGrCE,MAAAA,WAAW,EAAET;AAHwB,KAA3B,CAD6D;AAAA,GAA9C;AAAA,CAAH,gBAA1B;;AAOA,IAAMU,UAAU,GAAG;AAAA;;AAAA,MACjBC,KADiB,QACjBA,KADiB;AAAA,MAEjBC,SAFiB,QAEjBA,SAFiB;AAAA,SAGuC;AACxDC,IAAAA,SAAS,EAAEC,aAAK,CAACH,KAAD,CADwC;AAExDC,IAAAA,SAAS,EAATA;AAFwD,GAHvC;AAAA,CAAH,gBAAhB;AAQA;;;;;;IAIMG,wBAAwB,GAAG,kCAC/Bd,cAD+B,EAE/BK,OAF+B,EAG/BC,OAH+B;AAAA;;AAAA;;AAAA,SAK/B,IAAIS,iBAAJ,CACEC,WAAO,CACLZ,oBAAoB,CAACJ,cAAD,EAAiBK,OAAjB,EAA0BC,OAA1B,CADf,EAEL,UAAAW,OAAO;AAAA;;AAAA,WAAIC,WAAI,CAAClB,cAAD,EAAiBiB,OAAjB,CAAR;AAAA,GAFF,aAGLR,UAHK,CADT,CAL+B;AAAA,CAAH;;;;"}